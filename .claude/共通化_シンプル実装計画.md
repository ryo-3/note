# memo-screen.tsx と task-screen.tsx のシンプル共通化計画

## 概要
両画面で完全に同じコードをコピペしている部分のみを共通化する、低リスクな改善計画です。

## 共通化対象（超低リスク・見通しの良い部分のみ）

### 1. 削除完了時の蓋を閉じる処理
**現状**: 両画面で全く同じコード
```typescript
useEffect(() => {
  (window as any).closeDeletingLid = () => {
    setIsRightLidOpen(false);
  };
  
  return () => {
    delete (window as any).closeDeletingLid;
  };
}, []);
```

**共通化案**: カスタムフックにする
```typescript
// apps/web/src/hooks/use-deletion-lid.ts
export function useDeletionLid(onClose: () => void) {
  useEffect(() => {
    (window as any).closeDeletingLid = onClose;
    return () => {
      delete (window as any).closeDeletingLid;
    };
  }, [onClose]);
}
```

### 2. 削除・復元ボタンのコンテナ部分
**現状**: 位置とアニメーションのCSSクラスが完全に同じ

**共通化案**: 薄いラッパーコンポーネント
```typescript
// apps/web/components/ui/layout/button-container.tsx
interface ButtonContainerProps {
  show: boolean;
  position: 'bottom-left' | 'bottom-right';
  children: React.ReactNode;
}

export function ButtonContainer({ show, position, children }: ButtonContainerProps) {
  const positionClass = position === 'bottom-right' 
    ? 'absolute bottom-4 right-6' 
    : 'absolute bottom-4 left-6';
    
  return (
    <div className={`${positionClass} z-10 transition-opacity duration-300 ${
      show ? "opacity-100" : "opacity-0 pointer-events-none"
    }`}>
      {children}
    </div>
  );
}
```

### 3. 削除済みアイテム用の右下削除ボタン
**現状**: 両画面で構造が完全に同じ
```tsx
<div className={`${DELETE_BUTTON_POSITION} z-10`}>
  <DeleteButton
    data-right-panel-trash
    onDelete={() => {
      setIsRightLidOpen(true);
      deletedItemViewerRef.current?.showDeleteConfirmation();
    }}
    isAnimating={isRightLidOpen}
    variant="danger"
  />
</div>
```

**共通化案**: そのまま使えるコンポーネント
```typescript
// apps/web/components/ui/buttons/deleted-item-delete-button.tsx
interface DeletedItemDeleteButtonProps {
  onDelete: () => void;
  isAnimating: boolean;
}

export function DeletedItemDeleteButton({ onDelete, isAnimating }: DeletedItemDeleteButtonProps) {
  return (
    <div className={`${DELETE_BUTTON_POSITION} z-10`}>
      <DeleteButton
        data-right-panel-trash
        onDelete={onDelete}
        isAnimating={isAnimating}
        variant="danger"
      />
    </div>
  );
}
```

## 実装手順（1日で完了可能）

### ステップ1: カスタムフックの作成（30分）
1. `use-deletion-lid.ts` を作成
2. 両画面で import して使用

### ステップ2: ButtonContainerの作成（30分）
1. `button-container.tsx` を作成
2. 削除ボタンと復元ボタンの表示部分を置き換え

### ステップ3: DeletedItemDeleteButtonの作成（30分）
1. `deleted-item-delete-button.tsx` を作成
2. 削除済みアイテムビューアー用の削除ボタンを置き換え

### ステップ4: 動作確認（30分）
1. メモ画面の削除・復元機能の動作確認
2. タスク画面の削除・復元機能の動作確認

## メリット
- **コード削減**: 約50-70行の重複削除
- **保守性**: バグ修正が1箇所で済む
- **リスクなし**: ロジックは変更せず、見た目だけ共通化

## やらないこと
- 全選択ロジックの統合（タスクとメモで条件が違うため）
- 削除状態管理の統合（複雑になるため）
- 削除処理フローの統合（画面ごとに異なる要件があるため）

## 成功の基準
- 既存の動作が100%維持される
- コードの見通しが良くなる
- 新しい依存関係を作らない